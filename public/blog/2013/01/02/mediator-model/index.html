
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>模式应用小分享——中介者模式(mediator) - Litten's Blog</title>
	<meta name="author" content="Litten">

	
	<meta name="description" content="模式应用小分享——中介者模式(mediator) 你需要一种设计模式，一定是哪里出问题了。这问题是指语言天生缺陷，不得不去寻找一种通用的解决方案。 程序设计最后的终点，就是要找到一种解决方案来解决问题。这句话正确无疑。但我又想起有个冷笑话，A对B说：我教你怎么去赢这盘象棋，B问怎样，A回答说： &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="http://feed.feedsky.com/litten" rel="alternate" title="Litten's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://litten.github.io/blog/2013/01/02/mediator-model/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='/images/social/litten.png' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>

<hgroup>
  <h1><a href="/">Litten</a></h1>
</hgroup>
<p class="subtitle">Simple and clear</p>
<nav id="main-nav"><ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
		
		
		
		
		
		
		
		<a class="weibo" target="_blank" href="http://weibo.com/litten225" title="weibo">新浪微博</a>
		
		
		<a class="rss" target="_blank" href="http://feed.feedsky.com/litten" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">模式应用小分享——中介者模式(mediator)</h1>
	<div class="entry-content" itemprop="articleBody"><p><img src="/assets/blogImg/mediator1.jpg" alt="实况足球" /></p>

<blockquote><p>你需要一种设计模式，一定是哪里出问题了。这问题是指语言天生缺陷，不得不去寻找一种通用的解决方案。</p></blockquote>

<p>程序设计最后的终点，就是要找到一种解决方案来解决问题。这句话正确无疑。但我又想起有个冷笑话，A对B说：我教你怎么去赢这盘象棋，B问怎样，A回答说：吃掉对方的“帅”就赢了啊。略去中间的过程，直接描述到结果，这其实是毫无意义的。而设计模式，又恰恰关乎中间解决问题的过程。</p>

<!-- more -->


<p>现在关于模式的文章与书籍层出不穷，我自己也在看。但当我将理论回归应用的时候，一下子就懵了。这么多的模式，就像是一张又一张的棋谱教学，它告诉你要这么那么做，但你很少知道如何对症下药。也许到最后你东拼西凑总可以把“帅”吃掉，但遇到一个问题，如何选择下一步的模式见招拆招，已达到最有效率的胜利呢？</p>

<p>因此我想写一些模式在应用方面的小分享。</p>

<h2><strong>中介者，你想到了什么？</strong></h2>

<p>我们可以从实况足球谈起。一场足球比赛，进球加分，犯规处罚，控制时间，这些事件都由一个人来处决，我们叫他裁判，其实他就是比赛的中介者。裁判童鞋，代表了一种<strong>“控制集中化”</strong>的理念，这就是中介者模式的关键。试想一下，我们平时打球一般没有裁判，比分多少，是否犯规等都是由运动员我们自己来记录的，而我们往往都会有记错比分或者犯规纠纷的经验吧。这反应到程序上，就可以说是交互的复杂性带来的混乱。因此，我们在正规的比赛中必须要有裁判，运动员才可以把全部精力放到比赛上面去。于是中介者的引入，把运动员自己的复杂性变成了中介者的复杂性。</p>

<p>再深入一点，为什么有了裁判后，运动员的精力可以更集中呢？原因很简单，我们不需要记对方的分数了，犯规了也用不着自己去跟对方辩论。也就是说，两个队伍之间完全不用有比赛信息的直接交流了，取而代之的是把自己的信息转交给了裁判，让裁判去衡量两个队伍的信息，再进行加分，去判定是否犯规。这时我们可以说，这两个队伍对象解耦了，队伍对象之间的解耦，在客户端程序设计上的效果是很显著的，你很容易再引入一个队伍对象进行管理。试想一下如果有一场奇怪的球赛是有三个，四个队伍一起进行的，有了裁判这个中介者，运动员还是可以集中精力去比赛，否则他们就要去再多记比分了。</p>

<h2><strong>一个例子</strong></h2>

<iframe id="demoIframe" src="/assets/demo/mediator/demo.html" width="500" height="314" scrolling="no"></iframe>


<p>或者点这里弹出看<a href="/assets/demo/mediator/demo.html">demo</a>       <br/>
三国无双游戏中，有个经典的桥段，大家称为“拼刀”。当两个武将触发拼刀时，武将用武器相互抵着，玩家需要疯狂的按攻击键，一定时间内，谁按的次数多，谁就能赢得拼刀的胜利。其实这就是一个中介者模式的好例子。</p>

<p>其实不止是像这种“比赛”，想想像电力公司，将各家的电力进行集中管理，像给大家批阅试卷，给出成绩的老师，像一下子可以灭所有灯的寝室楼阿姨，像中国人民代表大会…额好吧，总之就是这么回事。</p>

<h2><strong>demo代码解析 coffeescript实现（50行）</strong></h2>

<p>首先我们设定<code>Player</code>对象，它有points和name属性，同时有一个prototype的属性play，使自己的分数加以，并将这信息通知中介者mediator：</p>

<pre><code>Player = (name)-&gt;
    @points = 0
    @name = name

Player::play = -&gt;
    @points++
    mediator.played()
</code></pre>

<p>然后我们设定<code>scoreboard</code>对象，这是一个得分板，在MVC模式当中，充当了V(view)，视图。它的使命就是update，将传递给它的数据score展示出来。因为裁判是mediator，它判定队伍得分后(得到score)，他必须通知电视台(对应scoreboard)，让他们把分数展示出来：</p>

<pre><code>scoreboard = 
    element:
        document.getElementById "results"
    update:(score)-&gt;
        msg = ''
        for key,value of score 
            if score.hasOwnProperty key
                msg = msg+"&lt;span&gt;&lt;strong&gt;#{key}&lt;/strong&gt;:#{value}&lt;/span&gt;"
        @element.innerHTML = msg
        diff = score.Home - score.Guest
        if diff &gt; 15 
            alert "Home Win!"
            location.reload();
        else if diff &lt;-15
            alert "Guest Win!"
            location.reload();
        else
            document.getElementById('barGuest').style.width = 150 + (diff*10) + 'px'
</code></pre>

<p>最后的片段就是中介者，<code>mediator</code>。它首先要决定开始比赛，也就是setup，新建了一个名称为Home，一个名称为Guest的Player model。当两个player得分时，mediator执行played，收集两方的分数，构造成score对象，并将这score对象交由scoreboard展示。keypress则是用于判断怎样才算得分：</p>

<pre><code>mediator = 
    players:{}
    setup:-&gt;
        players = @players
        players.home = new Player 'Home'
        players.guest = new Player 'Guest'
    played:-&gt;
        players = @players
        score = 
            Home: players.home.points
            Guest:players.guest.points
        scoreboard.update score
    keypress:(e)-&gt;
        e = e|| window.event
        keycode = e.which
        if keycode is 102
            mediator.players.home.play()
            return
        if keycode is 106
            mediator.players.guest.play()
            return
</code></pre>

<p>最后执行，运行程序：</p>

<pre><code>mediator.setup()
window.onkeypress = mediator.keypress
</code></pre>

<h2><strong>小分享心得</strong></h2>

<p>中介者模式将控制集中化，colleague对象之间解耦，不必维护各自之间的网状通信，但mediator承受了所有colleague提供过来的信息，肯定会相对复杂。如何优化mediator也会成为一个课题。中介者模式有点像一对多的模型，一个mediator对应多个colleague，而如果现实模型是多对多的，中介者模型视复杂度来说不一定适合。</p>

<script type="text/javascript">
    var setFocus = function(){
        $('#demoIframe').focus();
        $('#demoIframe').contents().find('#textBox').focus();
    }
    setInterval(setFocus,200);
</script>

</div>

</article>

	<div class="share">
	<div class="jiathis_style" style="float:right;">
	    <a class="jiathis_button_tsina" title="分享到新浪微博"><span class="jiathis_txt jtico jtico_tsina"></span></a>
	    <a class="jiathis_button_tqq" title="分享到腾讯微博"><span class="jiathis_txt jtico jtico_tqq"></span></a>
	    <a class="jiathis_button_renren" title="分享到人人网"><span class="jiathis_txt jtico jtico_renren"></span></a>
	    <a class="jiathis_button_qzone" title="分享到QQ空间"><span class="jiathis_txt jtico jtico_qzone"></span></a>
	    <a class="jiathis_button_douban" title="分享到豆瓣"><span class="jiathis_txt jtico jtico_douban"></span></a>
	    <a class="jiathis_button_weixin" title="分享到微信"><span class="jiathis_txt jtico jtico_weixin"></span></a>
	</div>
	<!-- JiaThis Button BEGIN -->
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1373344788098833" charset="utf-8"></script>
</div>

<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js"></script>
</div>
			</div>
			<footer id="footer" class="inner"><hr>
<p>
  Copyright &copy; 2013 - Litten -
  <!-- <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> -->
</p>
</footer>
			











		</div>
	</div>
</body>
</html>
